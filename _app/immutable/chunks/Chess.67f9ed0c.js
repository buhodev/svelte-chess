var cn=Object.defineProperty;var an=(e,t,n)=>t in e?cn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var D=(e,t,n)=>(an(e,typeof t!="symbol"?t+"":t,n),n);import{S as Le,i as Fe,s as Be,k as he,l as ge,m as pe,h as J,n as oe,b as Ce,H as ke,o as mt,w as xe,U as ln,a as un,c as dn,X as Xe,p as Ie,G as $e,J as et,K as fn,y as hn,z as gn,A as pn,g as mn,d as bn,B as _n,Y as vn}from"./index.18b0dfda.js";const wn=["white","black"],Qe=["a","b","c","d","e","f","g","h"],je=["1","2","3","4","5","6","7","8"],kn=[...je].reverse(),He=Array.prototype.concat(...Qe.map(e=>je.map(t=>e+t))),F=e=>He[8*e[0]+e[1]],M=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],bt=He.map(M);function Sn(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const yn=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Ue=e=>e==="white"?"black":"white",me=(e,t)=>{const n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},qe=(e,t)=>e.role===t.role&&e.color===t.color,_e=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],U=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},_t=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},We=(e,t)=>{e.style.visibility=t?"visible":"hidden"},ce=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},vt=e=>e.buttons===2||e.button===2,W=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function wt(e,t,n){const i=M(e);return t||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}const se=(e,t)=>Math.abs(e-t),Cn=e=>(t,n,i,o)=>se(t,i)<2&&(e==="white"?o===n+1||n<=1&&o===n+2&&t===i:o===n-1||n>=6&&o===n-2&&t===i),kt=(e,t,n,i)=>{const o=se(e,n),r=se(t,i);return o===1&&r===2||o===2&&r===1},St=(e,t,n,i)=>se(e,n)===se(t,i),yt=(e,t,n,i)=>e===n||t===i,Ct=(e,t,n,i)=>St(e,t,n,i)||yt(e,t,n,i),Pn=(e,t,n)=>(i,o,r,s)=>se(i,r)<2&&se(o,s)<2||n&&o===s&&o===(e==="white"?0:7)&&(i===4&&(r===2&&t.includes(0)||r===6&&t.includes(7))||t.includes(r));function En(e,t){const n=t==="white"?"1":"8",i=[];for(const[o,r]of e)o[1]===n&&r.color===t&&r.role==="rook"&&i.push(M(o)[0]);return i}function Pt(e,t,n){const i=e.get(t);if(!i)return[];const o=M(t),r=i.role,s=r==="pawn"?Cn(i.color):r==="knight"?kt:r==="bishop"?St:r==="rook"?yt:r==="queen"?Ct:Pn(i.color,En(e,i.color),n);return bt.filter(c=>(o[0]!==c[0]||o[1]!==c[1])&&s(o[0],o[1],c[0],c[1])).map(F)}function x(e,...t){e&&setTimeout(()=>e(...t),1)}function Mn(e){e.orientation=Ue(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function An(e,t){for(const[n,i]of t)i?e.pieces.set(n,i):e.pieces.delete(n)}function Tn(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,i]of e.pieces)i.role==="king"&&i.color===t&&(e.check=n)}function Nn(e,t,n,i){te(e),e.premovable.current=[t,n],x(e.premovable.events.set,t,n,i)}function ee(e){e.premovable.current&&(e.premovable.current=void 0,x(e.premovable.events.unset))}function On(e,t,n){ee(e),e.predroppable.current={role:t,key:n},x(e.predroppable.events.set,t,n)}function te(e){const t=e.predroppable;t.current&&(t.current=void 0,x(t.events.unset))}function xn(e,t,n){if(!e.autoCastle)return!1;const i=e.pieces.get(t);if(!i||i.role!=="king")return!1;const o=M(t),r=M(n);if(o[1]!==0&&o[1]!==7||o[1]!==r[1])return!1;o[0]===4&&!e.pieces.has(n)&&(r[0]===6?n=F([7,r[1]]):r[0]===2&&(n=F([0,r[1]])));const s=e.pieces.get(n);return!s||s.color!==i.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),o[0]<r[0]?(e.pieces.set(F([6,r[1]]),i),e.pieces.set(F([5,r[1]]),s)):(e.pieces.set(F([2,r[1]]),i),e.pieces.set(F([3,r[1]]),s)),!0)}function Et(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);if(t===n||!i)return!1;const r=o&&o.color!==i.color?o:void 0;return n===e.selected&&Q(e),x(e.events.move,t,n,r),xn(e,t,n)||(e.pieces.set(n,i),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,x(e.events.change),r||!0}function Je(e,t,n,i){if(e.pieces.has(n))if(i)e.pieces.delete(n);else return!1;return x(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,x(e.events.change),e.movable.dests=void 0,e.turnColor=Ue(e.turnColor),!0}function Mt(e,t,n){const i=Et(e,t,n);return i&&(e.movable.dests=void 0,e.turnColor=Ue(e.turnColor),e.animation.current=void 0),i}function At(e,t,n){if(Ge(e,t,n)){const i=Mt(e,t,n);if(i){const o=e.hold.stop();Q(e);const r={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:o};return i!==!0&&(r.captured=i),x(e.movable.events.after,t,n,r),!0}}else if(qn(e,t,n))return Nn(e,t,n,{ctrlKey:e.stats.ctrlKey}),Q(e),!0;return Q(e),!1}function Tt(e,t,n,i){const o=e.pieces.get(t);o&&(In(e,t,n)||i)?(e.pieces.delete(t),Je(e,o,n,i),x(e.movable.events.afterNewPiece,o.role,n,{premove:!1,predrop:!1})):o&&Dn(e,t,n)?On(e,o.role,n):(ee(e),te(e)),e.pieces.delete(t),Q(e)}function De(e,t,n){if(x(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Q(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&At(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Ot(e,t)||Ve(e,t))&&(Nt(e,t),e.hold.start())}function Nt(e,t){e.selected=t,Ve(e,t)?e.premovable.dests=Pt(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function Q(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Ot(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Ge=(e,t,n)=>{var i,o;return t!==n&&Ot(e,t)&&(e.movable.free||!!(!((o=(i=e.movable.dests)===null||i===void 0?void 0:i.get(t))===null||o===void 0)&&o.includes(n)))};function In(e,t,n){const i=e.pieces.get(t);return!!i&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===i.color&&e.turnColor===i.color)}function Ve(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const qn=(e,t,n)=>t!==n&&Ve(e,t)&&Pt(e.pieces,t,e.premovable.castle).includes(n);function Dn(e,t,n){const i=e.pieces.get(t),o=e.pieces.get(n);return!!i&&(!o||o.color!==e.movable.color)&&e.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===i.color&&e.turnColor!==i.color}function Rn(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Kn(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],i=t[1];let o=!1;if(Ge(e,n,i)){const r=Mt(e,n,i);if(r){const s={premove:!0};r!==!0&&(s.captured=r),x(e.movable.events.after,n,i,s),o=!0}}return ee(e),o}function Ln(e,t){const n=e.predroppable.current;let i=!1;if(!n)return!1;if(t(n)){const o={role:n.role,color:e.movable.color};Je(e,o,n.key)&&(x(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return te(e),i}function ze(e){ee(e),te(e),Q(e)}function tt(e){e.movable.color=e.movable.dests=e.animation.current=void 0,ze(e)}function ae(e,t,n){let i=Math.floor(8*(e[0]-n.left)/n.width);t||(i=7-i);let o=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(o=7-o),i>=0&&i<8&&o>=0&&o<8?F([i,o]):void 0}function Fn(e,t,n,i){const o=M(e),r=bt.filter(a=>Ct(o[0],o[1],a[0],a[1])||kt(o[0],o[1],a[0],a[1])),c=r.map(a=>wt(F(a),n,i)).map(a=>me(t,a)),[,l]=c.reduce((a,h,d)=>a[0]<h?a:[h,d],[c[0],0]);return F(r[l])}const I=e=>e.orientation==="white",xt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Bn={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Qn={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function It(e){e==="start"&&(e=xt);const t=new Map;let n=7,i=0;for(const o of e)switch(o){case" ":case"[":return t;case"/":if(--n,n<0)return t;i=0;break;case"~":{const r=t.get(F([i-1,n]));r&&(r.promoted=!0);break}default:{const r=o.charCodeAt(0);if(r<57)i+=r-48;else{const s=o.toLowerCase();t.set(F([i,n]),{role:Bn[s],color:o===s?"black":"white"}),++i}}}return t}function jn(e){return kn.map(t=>Qe.map(n=>{const i=e.get(n+t);if(i){let o=Qn[i.role];return i.color==="white"&&(o=o.toUpperCase()),i.promoted&&(o+="~"),o}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function qt(e,t){t.animation&&(Ze(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Dt(e,t){var n,i,o;if(!((n=t.movable)===null||n===void 0)&&n.dests&&(e.movable.dests=void 0),!((i=t.drawable)===null||i===void 0)&&i.autoShapes&&(e.drawable.autoShapes=[]),Ze(e,t),t.fen&&(e.pieces=It(t.fen),e.drawable.shapes=((o=t.drawable)===null||o===void 0?void 0:o.shapes)||[]),"check"in t&&Tn(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Nt(e,e.selected),qt(e,t),!e.movable.rookCastle&&e.movable.dests){const r=e.movable.color==="white"?"1":"8",s="e"+r,c=e.movable.dests.get(s),l=e.pieces.get(s);if(!c||!l||l.role!=="king")return;e.movable.dests.set(s,c.filter(a=>!(a==="a"+r&&c.includes("c"+r))&&!(a==="h"+r&&c.includes("g"+r))))}}function Ze(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)&&nt(e[n])&&nt(t[n])?Ze(e[n],t[n]):e[n]=t[n])}function nt(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const ie=(e,t)=>t.animation.enabled?Wn(e,t):Y(e,t);function Y(e,t){const n=e(t);return t.dom.redraw(),n}const Ee=(e,t)=>({key:e,pos:M(e),piece:t}),Hn=(e,t)=>t.sort((n,i)=>me(e.pos,n.pos)-me(e.pos,i.pos))[0];function Un(e,t){const n=new Map,i=[],o=new Map,r=[],s=[],c=new Map;let l,a,h;for(const[d,u]of e)c.set(d,Ee(d,u));for(const d of He)l=t.pieces.get(d),a=c.get(d),l?a?qe(l,a.piece)||(r.push(a),s.push(Ee(d,l))):s.push(Ee(d,l)):a&&r.push(a);for(const d of s)a=Hn(d,r.filter(u=>qe(d.piece,u.piece))),a&&(h=[a.pos[0]-d.pos[0],a.pos[1]-d.pos[1]],n.set(d.key,h.concat(h)),i.push(a.key));for(const d of r)i.includes(d.key)||o.set(d.key,d.piece);return{anims:n,fadings:o}}function Rt(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const i=1-(t-n.start)*n.frequency;if(i<=0)e.animation.current=void 0,e.dom.redrawNow();else{const o=Jn(i);for(const r of n.plan.anims.values())r[2]=r[0]*o,r[3]=r[1]*o;e.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>Rt(e,r))}}function Wn(e,t){const n=new Map(t.pieces),i=e(t),o=Un(n,t);if(o.anims.size||o.fadings.size){const r=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:o},r||Rt(t,performance.now())}else t.dom.redraw();return i}const Jn=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Gn=["green","red","blue","yellow"];function Vn(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Q(e):ze(e);const n=ce(t),i=ae(n,I(e),e.dom.bounds());i&&(e.drawable.current={orig:i,pos:n,brush:Xn(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Kt(e))}function Kt(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=ae(t.pos,I(e),e.dom.bounds());n||(t.snapToValidMove=!1);const i=t.snapToValidMove?Fn(t.orig,t.pos,I(e),e.dom.bounds()):n;i!==t.mouseSq&&(t.mouseSq=i,t.dest=i!==t.orig?i:void 0,e.dom.redrawNow()),Kt(e)}})}function zn(e,t){e.drawable.current&&(e.drawable.current.pos=ce(t))}function Zn(e){const t=e.drawable.current;t&&(t.mouseSq&&$n(e.drawable,t),Lt(e))}function Lt(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Yn(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Ft(e.drawable))}function Xn(e){var t;const n=(e.shiftKey||e.ctrlKey)&&vt(e),i=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return Gn[(n?1:0)+(i?2:0)]}function $n(e,t){const n=o=>o.orig===t.orig&&o.dest===t.dest,i=e.shapes.find(n);i&&(e.shapes=e.shapes.filter(o=>!n(o))),(!i||i.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Ft(e)}function Ft(e){e.onChange&&e.onChange(e.shapes)}function ei(e,t){if(!t.isTrusted||t.button!==void 0&&t.button!==0||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),i=ce(t),o=ae(i,I(e),n);if(!o)return;const r=e.pieces.get(o),s=e.selected;!s&&e.drawable.enabled&&(e.drawable.eraseOnClick||!r||r.color!==e.turnColor)&&Yn(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||r||s||ti(e,i))&&t.preventDefault();const c=!!e.premovable.current,l=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Ge(e,e.selected,o)?ie(d=>De(d,o),e):De(e,o);const a=e.selected===o,h=Qt(e,o);if(r&&h&&a&&Rn(e,o)){e.draggable.current={orig:o,piece:r,origPos:i,pos:i,started:e.draggable.autoDistance&&e.stats.dragged,element:h,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},h.cgDragging=!0,h.classList.add("dragging");const d=e.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,U(d,_e(n)(M(o),I(e))),We(d,!0)),Ye(e)}else c&&ee(e),l&&te(e);e.dom.redraw()}function ti(e,t){const n=I(e),i=e.dom.bounds(),o=Math.pow(i.width/8,2);for(const r of e.pieces.keys()){const s=wt(r,n,i);if(me(s,t)<=o)return!0}return!1}function ni(e,t,n,i){const o="a0";e.pieces.set(o,t),e.dom.redraw();const r=ce(n);e.draggable.current={orig:o,piece:t,origPos:r,pos:r,started:!0,element:()=>Qt(e,o),originTarget:n.target,newPiece:!0,force:!!i,keyHasChanged:!1},Ye(e)}function Ye(e){requestAnimationFrame(()=>{var t;const n=e.draggable.current;if(!n)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(n.orig)&&(e.animation.current=void 0);const i=e.pieces.get(n.orig);if(!i||!qe(i,n.piece))Se(e);else if(!n.started&&me(n.pos,n.origPos)>=Math.pow(e.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const o=e.dom.bounds();U(n.element,[n.pos[0]-o.left-o.width/16,n.pos[1]-o.top-o.height/16]),n.keyHasChanged||(n.keyHasChanged=n.orig!==ae(n.pos,I(e),o))}Ye(e)})}function ii(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=ce(t))}function oi(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}ee(e),te(e);const i=ce(t)||n.pos,o=ae(i,I(e),e.dom.bounds());o&&n.started&&n.orig!==o?n.newPiece?Tt(e,n.orig,o,n.force):(e.stats.ctrlKey=t.ctrlKey,At(e,n.orig,o)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!o&&(e.pieces.delete(n.orig),x(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===o||!o)?Q(e):e.selectable.enabled||Q(e),Bt(e),e.draggable.current=void 0,e.dom.redraw()}function Se(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Q(e),Bt(e),e.dom.redraw())}function Bt(e){const t=e.dom.elements;t.ghost&&We(t.ghost,!1)}function Qt(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function ri(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{it(e,2),setTimeout(()=>it(e,void 0),120)},120)}function it(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function si(e,t){function n(){Mn(e),t()}return{set(i){i.orientation&&i.orientation!==e.orientation&&n(),qt(e,i),(i.fen?ie:Y)(o=>Dt(o,i),e)},state:e,getFen:()=>jn(e.pieces),toggleOrientation:n,setPieces(i){ie(o=>An(o,i),e)},selectSquare(i,o){i?ie(r=>De(r,i,o),e):e.selected&&(Q(e),e.dom.redraw())},move(i,o){ie(r=>Et(r,i,o),e)},newPiece(i,o){ie(r=>Je(r,i,o),e)},playPremove(){if(e.premovable.current){if(ie(Kn,e))return!0;e.dom.redraw()}return!1},playPredrop(i){if(e.predroppable.current){const o=Ln(e,i);return e.dom.redraw(),o}return!1},cancelPremove(){Y(ee,e)},cancelPredrop(){Y(te,e)},cancelMove(){Y(i=>{ze(i),Se(i)},e)},stop(){Y(i=>{tt(i),Se(i)},e)},explode(i){ri(e,i)},setAutoShapes(i){Y(o=>o.drawable.autoShapes=i,e)},setShapes(i){Y(o=>o.drawable.shapes=i,e)},getKeyAtDomPos(i){return ae(i,I(e),e.dom.bounds())},redrawAll:t,dragNewPiece(i,o,r){ni(e,i,o,r)},destroy(){tt(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function ci(){return{pieces:It(xt),orientation:"white",turnColor:"white",coordinates:!0,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},prevSvgHash:""},hold:yn()}}function Re(e,t,n){const i=new Map,o=[];for(const c of e)i.set(c.hash,!1);let r=t.firstChild,s;for(;r;)s=r.getAttribute("cgHash"),i.has(s)?i.set(s,!0):o.push(r),r=r.nextSibling;for(const c of o)t.removeChild(c);for(const c of e)i.get(c.hash)||t.appendChild(n(c))}function B(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ai(e,t,n){const i=e.drawable,o=i.current,r=o&&o.mouseSq?o:void 0,s=new Map,c=e.dom.bounds(),l=i.autoShapes.filter(f=>!f.piece);for(const f of i.shapes.concat(l).concat(r?[r]:[]))f.dest&&s.set(f.dest,(s.get(f.dest)||0)+1);const a=i.shapes.concat(l).map(f=>({shape:f,current:!1,hash:ot(f,s,!1,c)}));r&&a.push({shape:r,current:!0,hash:ot(r,s,!0,c)});const h=a.map(f=>f.hash).join(";");if(h===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=h;const d=t.querySelector("defs"),u=t.querySelector("g"),w=n.querySelector("g");li(i,a,d),Re(a.filter(f=>!f.shape.customSvg),u,f=>rt(e,f,i.brushes,s,c)),Re(a.filter(f=>f.shape.customSvg),w,f=>rt(e,f,i.brushes,s,c))}function li(e,t,n){var i;const o=new Map;let r;for(const l of t)l.shape.dest&&(r=e.brushes[l.shape.brush],l.shape.modifiers&&(r=jt(r,l.shape.modifiers)),!((i=l.shape.modifiers)===null||i===void 0)&&i.hilite&&o.set("hilite",{key:"hilite",color:"white",opacity:1,lineWidth:1}),o.set(r.key,r));const s=new Set;let c=n.firstChild;for(;c;)s.add(c.getAttribute("cgKey")),c=c.nextSibling;for(const[l,a]of o.entries())s.has(l)||n.appendChild(mi(a))}function ot({orig:e,dest:t,brush:n,piece:i,modifiers:o,customSvg:r},s,c,l){return[l.width,l.height,c,e,t,n,t&&(s.get(t)||0)>1,i&&ui(i),o&&di(o),r&&fi(r)].filter(a=>a).join(",")}function ui(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function di(e){return[e.lineWidth,e.hilite].filter(t=>t).join(",")}function fi(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return"custom-"+t.toString()}function rt(e,{shape:t,current:n,hash:i},o,r,s){var c;let l;const a=st(M(t.orig),e.orientation);if(t.customSvg)l=hi(t.customSvg,a,s);else if(t.dest&&t.dest!=t.orig){let h=o[t.brush];t.modifiers&&(h=jt(h,t.modifiers)),l=pi(h,a,st(M(t.dest),e.orientation),n,(r.get(t.dest)||0)>1,s,(c=t.modifiers)===null||c===void 0?void 0:c.hilite)}else l=gi(o[t.brush],a,n,s);return l.setAttribute("cgHash",i),l}function hi(e,t,n){const[i,o]=ye(t,n),r=$(B("g"),{transform:`translate(${i},${o})`}),s=$(B("svg"),{width:1,height:1,viewBox:"0 0 100 100"});return r.appendChild(s),s.innerHTML=e,r}function gi(e,t,n,i){const o=ye(t,i),r=bi(),s=(i.width+i.height)/(4*Math.max(i.width,i.height));return $(B("circle"),{stroke:e.color,"stroke-width":r[n?0:1],fill:"none",opacity:Ht(e,n),cx:o[0],cy:o[1],r:s-r[1]/2})}function pi(e,t,n,i,o,r,s=!1){function c(a){const h=vi(o&&!i),d=ye(t,r),u=ye(n,r),w=u[0]-d[0],f=u[1]-d[1],g=Math.atan2(f,w),S=Math.cos(g)*h,m=Math.sin(g)*h;return $(B("line"),{stroke:a?"white":e.color,"stroke-width":_i(e,i)+(a?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${a?"hilite":e.key})`,opacity:a?1:Ht(e,i),x1:d[0],y1:d[1],x2:u[0]-S,y2:u[1]-m})}const l=s?B("g"):c(!1);return s&&[!0,!1].map(a=>l.appendChild(c(a))),l}function mi(e){const t=$(B("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:e.key==="hilite"?1.86:2.05,refY:2});return t.appendChild($(B("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function $(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function st(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function jt(e,t){return{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}}function bi(){return[3/64,4/64]}function _i(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Ht(e,t){return(e.opacity||1)*(t?.9:1)}function vi(e){return(e?20:10)/64}function ye(e,t){const n=Math.min(1,t.width/t.height),i=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*i]}function wi(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const l of wn)e.classList.toggle("orientation-"+l,t.orientation===l);e.classList.toggle("manipulable",!t.viewOnly);const n=W("cg-container");e.appendChild(n);const i=W("cg-board");n.appendChild(i);let o,r,s;if(t.drawable.visible&&(o=$(B("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),o.appendChild(B("defs")),o.appendChild(B("g")),r=$(B("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),r.appendChild(B("g")),s=W("cg-auto-pieces"),n.appendChild(o),n.appendChild(r),n.appendChild(s)),t.coordinates){const l=t.orientation==="black"?" black":"",a=t.ranksPosition==="left"?" left":"";n.appendChild(ct(je,"ranks"+l+a)),n.appendChild(ct(Qe,"files"+l))}let c;return t.draggable.enabled&&t.draggable.showGhost&&(c=W("piece","ghost"),We(c,!1),n.appendChild(c)),{board:i,container:n,wrap:e,ghost:c,svg:o,customSvg:r,autoPieces:s}}function ct(e,t){const n=W("coords",t);let i;for(const o of e)i=W("coord"),i.textContent=o,n.appendChild(i);return n}function ki(e,t){if(!e.dropmode.active)return;ee(e),te(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const i=ce(t),o=i&&ae(i,I(e),e.dom.bounds());o&&Tt(e,"a0",o)}e.dom.redraw()}function Si(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",o=>o.preventDefault()),e.viewOnly)return;const i=Ci(e);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1})}function yi(e,t){const n=[];if("ResizeObserver"in window||n.push(le(document.body,"chessground.resize",t)),!e.viewOnly){const i=at(e,ii,zn),o=at(e,oi,Zn);for(const s of["touchmove","mousemove"])n.push(le(document,s,i));for(const s of["touchend","mouseup"])n.push(le(document,s,o));const r=()=>e.dom.bounds.clear();n.push(le(document,"scroll",r,{capture:!0,passive:!0})),n.push(le(window,"resize",r,{passive:!0}))}return()=>n.forEach(i=>i())}function le(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}const Ci=e=>t=>{e.draggable.current?Se(e):e.drawable.current?Lt(e):t.shiftKey||vt(t)?e.drawable.enabled&&Vn(e,t):e.viewOnly||(e.dropmode.active?ki(e,t):ei(e,t))},at=(e,t,n)=>i=>{e.drawable.current?e.drawable.enabled&&n(e,i):e.viewOnly||t(e,i)};function Pi(e){const t=I(e),n=_e(e.dom.bounds()),i=e.dom.elements.board,o=e.pieces,r=e.animation.current,s=r?r.plan.anims:new Map,c=r?r.plan.fadings:new Map,l=e.draggable.current,a=Mi(e),h=new Set,d=new Set,u=new Map,w=new Map;let f,g,S,m,P,p,y,E,j,H;for(g=i.firstChild;g;){if(f=g.cgKey,Ut(g))if(S=o.get(f),P=s.get(f),p=c.get(f),m=g.cgPiece,g.cgDragging&&(!l||l.orig!==f)&&(g.classList.remove("dragging"),U(g,n(M(f),t)),g.cgDragging=!1),!p&&g.cgFading&&(g.cgFading=!1,g.classList.remove("fading")),S){if(P&&g.cgAnimating&&m===ue(S)){const C=M(f);C[0]+=P[2],C[1]+=P[3],g.classList.add("anim"),U(g,n(C,t))}else g.cgAnimating&&(g.cgAnimating=!1,g.classList.remove("anim"),U(g,n(M(f),t)),e.addPieceZIndex&&(g.style.zIndex=Me(M(f),t)));m===ue(S)&&(!p||!g.cgFading)?h.add(f):p&&m===ue(p)?(g.classList.add("fading"),g.cgFading=!0):Ae(u,m,g)}else Ae(u,m,g);else if(Wt(g)){const C=g.className;a.get(f)===C?d.add(f):Ae(w,C,g)}g=g.nextSibling}for(const[C,_]of a)if(!d.has(C)){j=w.get(_),H=j&&j.pop();const O=n(M(C),t);if(H)H.cgKey=C,U(H,O);else{const q=W("square",_);q.cgKey=C,U(q,O),i.insertBefore(q,i.firstChild)}}for(const[C,_]of o)if(P=s.get(C),!h.has(C))if(y=u.get(ue(_)),E=y&&y.pop(),E){E.cgKey=C,E.cgFading&&(E.classList.remove("fading"),E.cgFading=!1);const O=M(C);e.addPieceZIndex&&(E.style.zIndex=Me(O,t)),P&&(E.cgAnimating=!0,E.classList.add("anim"),O[0]+=P[2],O[1]+=P[3]),U(E,n(O,t))}else{const O=ue(_),q=W("piece",O),G=M(C);q.cgPiece=O,q.cgKey=C,P&&(q.cgAnimating=!0,G[0]+=P[2],G[1]+=P[3]),U(q,n(G,t)),e.addPieceZIndex&&(q.style.zIndex=Me(G,t)),i.appendChild(q)}for(const C of u.values())ut(e,C);for(const C of w.values())ut(e,C)}function Ei(e){const t=I(e),n=_e(e.dom.bounds());let i=e.dom.elements.board.firstChild;for(;i;)(Ut(i)&&!i.cgAnimating||Wt(i))&&U(i,n(M(i.cgKey),t)),i=i.nextSibling}function lt(e){var t,n;const i=e.dom.elements.wrap.getBoundingClientRect(),o=e.dom.elements.container,r=i.height/i.width,s=Math.floor(i.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,c=s*r;o.style.width=s+"px",o.style.height=c+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("--cg-width",s+"px"),(n=e.addDimensionsCssVarsTo)===null||n===void 0||n.style.setProperty("--cg-height",c+"px")}const Ut=e=>e.tagName==="PIECE",Wt=e=>e.tagName==="SQUARE";function ut(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function Me(e,t){const i=e[1];return`${t?3+7-i:3+i}`}const ue=e=>`${e.color} ${e.role}`;function Mi(e){var t;const n=new Map;if(e.lastMove&&e.highlight.lastMove)for(const r of e.lastMove)V(n,r,"last-move");if(e.check&&e.highlight.check&&V(n,e.check,"check"),e.selected&&(V(n,e.selected,"selected"),e.movable.showDests)){const r=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(r)for(const c of r)V(n,c,"move-dest"+(e.pieces.has(c)?" oc":""));const s=e.premovable.dests;if(s)for(const c of s)V(n,c,"premove-dest"+(e.pieces.has(c)?" oc":""))}const i=e.premovable.current;if(i)for(const r of i)V(n,r,"current-premove");else e.predroppable.current&&V(n,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const r of o.keys)V(n,r,"exploding"+o.stage);return n}function V(e,t,n){const i=e.get(t);i?e.set(t,`${i} ${n}`):e.set(t,n)}function Ae(e,t,n){const i=e.get(t);i?i.push(n):e.set(t,[n])}function Ai(e,t){const i=e.drawable.autoShapes.filter(o=>o.piece).map(o=>({shape:o,hash:Oi(o),current:!1}));Re(i,t,o=>Ni(e,o,e.dom.bounds()))}function Ti(e){var t;const n=I(e),i=_e(e.dom.bounds());let o=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;o;)_t(o,i(M(o.cgKey),n),o.cgScale),o=o.nextSibling}function Ni(e,{shape:t,hash:n},i){var o,r,s;const c=t.orig,l=(o=t.piece)===null||o===void 0?void 0:o.role,a=(r=t.piece)===null||r===void 0?void 0:r.color,h=(s=t.piece)===null||s===void 0?void 0:s.scale,d=W("piece",`${l} ${a}`);return d.setAttribute("cgHash",n),d.cgKey=c,d.cgScale=h,_t(d,_e(i)(M(c),I(e)),h),d}const Oi=e=>{var t,n,i;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(n=e.piece)===null||n===void 0?void 0:n.color,(i=e.piece)===null||i===void 0?void 0:i.scale].join(",")};function xi(e,t){const n=ci();Dt(n,t||{});function i(){const o="dom"in n?n.dom.unbind:void 0,r=wi(e,n),s=Sn(()=>r.board.getBoundingClientRect()),c=h=>{Pi(a),r.autoPieces&&Ai(a,r.autoPieces),!h&&r.svg&&ai(a,r.svg,r.customSvg)},l=()=>{lt(a),Ei(a),r.autoPieces&&Ti(a)},a=n;return a.dom={elements:r,bounds:s,redraw:Ii(c),redrawNow:c,unbind:o},a.drawable.prevSvgHash="",lt(a),c(!1),Si(a,l),o||(a.dom.unbind=yi(a,l)),a.events.insert&&a.events.insert(r),a}return si(i(),i)}function Ii(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}function qi(e){let t,n;return{c(){t=he("div"),this.h()},l(i){t=ge(i,"DIV",{class:!0}),pe(t).forEach(J),this.h()},h(){oe(t,"class",n="cg-wrap "+e[0]+" svelte-d0p6kd")},m(i,o){Ce(i,t,o),e[36](t)},p(i,o){o[0]&1&&n!==(n="cg-wrap "+i[0]+" svelte-d0p6kd")&&oe(t,"class",n)},i:ke,o:ke,d(i){i&&J(t),e[36](null)}}}function Di(e,t,n){let{className:i="cg-default-style"}=t,{fen:o=void 0}=t,{orientation:r=void 0}=t,{turnColor:s=void 0}=t,{check:c=void 0}=t,{lastMove:l=void 0}=t,{selected:a=void 0}=t,{coordinates:h=void 0}=t,{autoCastle:d=void 0}=t,{viewOnly:u=void 0}=t,{disableContextMenu:w=void 0}=t,{addPieceZIndex:f=void 0}=t,{addDimensionsCssVarsTo:g=void 0}=t,{blockTouchScroll:S=void 0}=t,{config:m={}}=t,P,p;mt(async()=>{r!==void 0&&n(2,m.orientation=r,m),o!==void 0&&n(2,m.fen=o,m),s!==void 0&&n(2,m.turnColor=s,m),c!==void 0&&n(2,m.check=c,m),l!==void 0&&n(2,m.lastMove=l,m),a!==void 0&&n(2,m.selected=a,m),h!==void 0&&n(2,m.coordinates=h,m),d!==void 0&&n(2,m.autoCastle=d,m),u!==void 0&&n(2,m.viewOnly=u,m),w!==void 0&&n(2,m.disableContextMenu=w,m),f!==void 0&&n(2,m.addPieceZIndex=f,m),g!==void 0&&n(2,m.addDimensionsCssVarsTo=g,m),S!==void 0&&n(2,m.blockTouchScroll=S,m),p=xi(P,m)});function y(b){p&&p.set(b)}function E(b){p.set(b)}function j(){return p.state}function H(){return p.getFen()}function C(){return p.toggleOrientation()}function _(b,ne){return p.move(b,ne)}function O(b){return p.setPieces(b)}function q(b,ne){return p.selectSquare(b,ne)}function G(b,ne){return p.newPiece(b,ne)}function Pe(){return p.playPremove()}function Gt(){p.cancelPremove()}function Vt(b){return p.playPredrop(b)}function zt(){p.cancelPredrop()}function Zt(){p.cancelMove()}function Yt(){p.stop()}function Xt(b){p.explode(b)}function $t(b){p.setShapes(b)}function en(b){p.setAutoShapes(b)}function tn(){return p.redrawAll()}function nn(b,ne,sn){p.dragNewPiece(b,ne,sn)}function on(){return p.destroy()}function rn(b){xe[b?"unshift":"push"](()=>{P=b,n(1,P)})}return e.$$set=b=>{"className"in b&&n(0,i=b.className),"fen"in b&&n(3,o=b.fen),"orientation"in b&&n(4,r=b.orientation),"turnColor"in b&&n(5,s=b.turnColor),"check"in b&&n(6,c=b.check),"lastMove"in b&&n(7,l=b.lastMove),"selected"in b&&n(8,a=b.selected),"coordinates"in b&&n(9,h=b.coordinates),"autoCastle"in b&&n(10,d=b.autoCastle),"viewOnly"in b&&n(11,u=b.viewOnly),"disableContextMenu"in b&&n(12,w=b.disableContextMenu),"addPieceZIndex"in b&&n(13,f=b.addPieceZIndex),"addDimensionsCssVarsTo"in b&&n(14,g=b.addDimensionsCssVarsTo),"blockTouchScroll"in b&&n(15,S=b.blockTouchScroll),"config"in b&&n(2,m=b.config)},e.$$.update=()=>{e.$$.dirty[0]&8&&y({fen:o}),e.$$.dirty[0]&16&&y({orientation:r}),e.$$.dirty[0]&32&&y({turnColor:s}),e.$$.dirty[0]&64&&y({check:c}),e.$$.dirty[0]&128&&y({lastMove:l}),e.$$.dirty[0]&256&&y({selected:a}),e.$$.dirty[0]&512&&y({coordinates:h}),e.$$.dirty[0]&1024&&y({autoCastle:d}),e.$$.dirty[0]&2048&&y({viewOnly:u}),e.$$.dirty[0]&4096&&y({disableContextMenu:w}),e.$$.dirty[0]&8192&&y({addPieceZIndex:f}),e.$$.dirty[0]&16384&&y({addDimensionsCssVarsTo:g}),e.$$.dirty[0]&32768&&y({blockTouchScroll:S}),e.$$.dirty[0]&4&&y(m)},[i,P,m,o,r,s,c,l,a,h,d,u,w,f,g,S,E,j,H,C,_,O,q,G,Pe,Gt,Vt,zt,Zt,Yt,Xt,$t,en,tn,nn,on,rn]}class Ri extends Le{constructor(t){super(),Fe(this,t,Di,qi,Be,{className:0,fen:3,orientation:4,turnColor:5,check:6,lastMove:7,selected:8,coordinates:9,autoCastle:10,viewOnly:11,disableContextMenu:12,addPieceZIndex:13,addDimensionsCssVarsTo:14,blockTouchScroll:15,config:2,set:16,getState:17,getFen:18,toggleOrientation:19,move:20,setPieces:21,selectSquare:22,newPiece:23,playPremove:24,cancelPremove:25,playPredrop:26,cancelPredrop:27,cancelMove:28,stop:29,explode:30,setShapes:31,setAutoShapes:32,redrawAll:33,dragNewPiece:34,destroy:35},null,[-1,-1])}get set(){return this.$$.ctx[16]}get getState(){return this.$$.ctx[17]}get getFen(){return this.$$.ctx[18]}get toggleOrientation(){return this.$$.ctx[19]}get move(){return this.$$.ctx[20]}get setPieces(){return this.$$.ctx[21]}get selectSquare(){return this.$$.ctx[22]}get newPiece(){return this.$$.ctx[23]}get playPremove(){return this.$$.ctx[24]}get cancelPremove(){return this.$$.ctx[25]}get playPredrop(){return this.$$.ctx[26]}get cancelPredrop(){return this.$$.ctx[27]}get cancelMove(){return this.$$.ctx[28]}get stop(){return this.$$.ctx[29]}get explode(){return this.$$.ctx[30]}get setShapes(){return this.$$.ctx[31]}get setAutoShapes(){return this.$$.ctx[32]}get redrawAll(){return this.$$.ctx[33]}get dragNewPiece(){return this.$$.ctx[34]}get destroy(){return this.$$.ctx[35]}}function dt(e,t,n){const i=e.slice();i[9]=t[n],i[12]=n;const o=i[2]?i[12]*12.5:100-12.5*(i[12]+1);return i[10]=o,i}function ft(e){let t,n,i,o,r;function s(){return e[7](e[9])}function c(...l){return e[8](e[9],...l)}return{c(){t=he("div"),n=he("div"),i=un(),this.h()},l(l){t=ge(l,"DIV",{class:!0,style:!0});var a=pe(t);n=ge(a,"DIV",{class:!0,role:!0,tabindex:!0}),pe(n).forEach(J),i=dn(a),a.forEach(J),this.h()},h(){oe(n,"class","piece "+e[9]+" svelte-1692twp"),oe(n,"role","button"),oe(n,"tabindex","0"),Xe(n,"white",e[2]),Xe(n,"black",e[3]),oe(t,"class","square svelte-1692twp"),Ie(t,"margin-left",e[1]+"%"),Ie(t,"margin-top",e[10]+"%")},m(l,a){Ce(l,t,a),$e(t,n),$e(t,i),o||(r=[et(n,"click",s),et(n,"keydown",c)],o=!0)},p(l,a){e=l},d(l){l&&J(t),o=!1,fn(r)}}}function Ki(e){let t,n=e[4],i=[];for(let o=0;o<n.length;o+=1)i[o]=ft(dt(e,n,o));return{c(){t=he("div");for(let o=0;o<i.length;o+=1)i[o].c();this.h()},l(o){t=ge(o,"DIV",{class:!0});var r=pe(t);for(let s=0;s<i.length;s+=1)i[s].l(r);r.forEach(J),this.h()},h(){oe(t,"class","dialog svelte-1692twp")},m(o,r){Ce(o,t,r);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[r]){if(r&63){n=o[4];let s;for(s=0;s<n.length;s+=1){const c=dt(o,n,s);i[s]?i[s].p(c,r):(i[s]=ft(c),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:ke,o:ke,d(o){o&&J(t),ln(i,o)}}}function Li(e){return e.charCodeAt(0)-97}function Fi(e,t,n){let{square:i}=t,{callback:o}=t;const r=100*Li(i)/8,s=i.charAt(1)==="8",c=!s,l=["q","n","r","b"];function a(u,w){(u.key==="Enter"||u.key===" ")&&o(w)}const h=u=>o(u),d=(u,w)=>a(w,u);return e.$$set=u=>{"square"in u&&n(6,i=u.square),"callback"in u&&n(0,o=u.callback)},[o,r,s,c,l,a,i,h,d]}class Bi extends Le{constructor(t){super(),Fe(this,t,Fi,Ki,Be,{square:6,callback:0})}}/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const N="w",L="b",A="p",Ke="n",we="b",fe="r",X="q",T="k",Te="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",R=-1,Qi={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},ji=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],v={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},k={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ne={b:[16,32,17,15],w:[-16,-32,-17,-15]},ht={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Hi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ui=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Wi={p:1,n:2,b:4,r:8,q:16,k:32},Ji="pnbrqkPNBRQK",gt=[Ke,we,fe,X],Gi=7,Vi=6,zi=1,Zi=0,ve={[T]:v.KSIDE_CASTLE,[X]:v.QSIDE_CASTLE},z={w:[{square:k.a1,flag:v.QSIDE_CASTLE},{square:k.h1,flag:v.KSIDE_CASTLE}],b:[{square:k.a8,flag:v.QSIDE_CASTLE},{square:k.h8,flag:v.KSIDE_CASTLE}]},Yi={b:zi,w:Vi},Xi=["1-0","0-1","1/2-1/2","*"];function re(e){return e>>4}function be(e){return e&15}function Jt(e){return"0123456789".indexOf(e)!==-1}function K(e){const t=be(e),n=re(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(n,n+1)}function de(e){return e===N?L:N}function $i(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(t[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(t[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const o=t[0].split("/");if(o.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let s=0;s<o.length;s++){let c=0,l=!1;for(let a=0;a<o[s].length;a++)if(Jt(o[s][a])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};c+=parseInt(o[s][a],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[s][a]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};c+=1,l=!1}if(c!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:s,regex:c}of r){if(!c.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${s} king`};if((t[0].match(c)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${s} kings`}}return{ok:!0}}function eo(e,t){const n=e.from,i=e.to,o=e.piece;let r=0,s=0,c=0;for(let l=0,a=t.length;l<a;l++){const h=t[l].from,d=t[l].to,u=t[l].piece;o===u&&n!==h&&i===d&&(r++,re(n)===re(h)&&s++,be(n)===be(h)&&c++)}return r>0?s>0&&c>0?K(n):c>0?K(n).charAt(1):K(n).charAt(0):""}function Z(e,t,n,i,o,r=void 0,s=v.NORMAL){const c=re(i);if(o===A&&(c===Gi||c===Zi))for(let l=0;l<gt.length;l++){const a=gt[l];e.push({color:t,from:n,to:i,piece:o,captured:r,promotion:a,flags:s|v.PROMOTION})}else e.push({color:t,from:n,to:i,piece:o,captured:r,flags:s})}function pt(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:A:(t=t.toLowerCase(),t==="o"?T:t)}function Oe(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}let to=class{constructor(t=Te){D(this,"_board",new Array(128));D(this,"_turn",N);D(this,"_header",{});D(this,"_kings",{w:R,b:R});D(this,"_epSquare",-1);D(this,"_halfMoves",0);D(this,"_moveNumber",0);D(this,"_history",[]);D(this,"_comments",{});D(this,"_castling",{w:0,b:0});this.load(t)}clear(t=!1){this._board=new Array(128),this._kings={w:R,b:R},this._turn=N,this._castling={w:0,b:0},this._epSquare=R,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{},this._updateSetup(this.fen())}removeHeader(t){t in this._header&&delete this._header[t]}load(t,n=!1){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const l=["-","-","0","1"];t=i.concat(l.slice(-(6-i.length))).join(" ")}i=t.split(/\s+/);const{ok:o,error:r}=$i(t);if(!o)throw new Error(r);const s=i[0];let c=0;this.clear(n);for(let l=0;l<s.length;l++){const a=s.charAt(l);if(a==="/")c+=8;else if(Jt(a))c+=parseInt(a,10);else{const h=a<"a"?N:L;this.put({type:a.toLowerCase(),color:h},K(c)),c++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=v.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=v.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=v.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=v.QSIDE_CASTLE),this._epSquare=i[3]==="-"?R:k[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(this.fen())}fen(){var r,s;let t=0,n="";for(let c=k.a8;c<=k.h1;c++){if(this._board[c]){t>0&&(n+=t,t=0);const{color:l,type:a}=this._board[c];n+=l===N?a.toUpperCase():a.toLowerCase()}else t++;c+1&136&&(t>0&&(n+=t),c!==k.h1&&(n+="/"),t=0,c+=8)}let i="";this._castling[N]&v.KSIDE_CASTLE&&(i+="K"),this._castling[N]&v.QSIDE_CASTLE&&(i+="Q"),this._castling[L]&v.KSIDE_CASTLE&&(i+="k"),this._castling[L]&v.QSIDE_CASTLE&&(i+="q"),i=i||"-";let o="-";if(this._epSquare!==R){const c=this._epSquare+(this._turn===N?16:-16),l=[c+1,c-1];for(const a of l){if(a&136)continue;const h=this._turn;if(((r=this._board[a])==null?void 0:r.color)===h&&((s=this._board[a])==null?void 0:s.type)===A){this._makeMove({color:h,from:a,to:this._epSquare,piece:A,captured:A,flags:v.EP_CAPTURE});const d=!this._isKingAttacked(h);if(this._undoMove(),d){o=K(this._epSquare);break}}}}return[n,this._turn,i,o,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(t){this._history.length>0||(t!==Te?(this._header.SetUp="1",this._header.FEN=t):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(Te)}get(t){return this._board[k[t]]||!1}put({type:t,color:n},i){if(Ji.indexOf(t.toLowerCase())===-1||!(i in k))return!1;const o=k[i];return t==T&&!(this._kings[n]==R||this._kings[n]==o)?!1:(this._board[o]={type:t,color:n},t===T&&(this._kings[n]=o),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}remove(t){const n=this.get(t);return delete this._board[k[t]],n&&n.type===T&&(this._kings[n.color]=R),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,o,r,s,c,l,a,h,d,u,w,f;const t=((i=this._board[k.e1])==null?void 0:i.type)===T&&((o=this._board[k.e1])==null?void 0:o.color)===N,n=((r=this._board[k.e8])==null?void 0:r.type)===T&&((s=this._board[k.e8])==null?void 0:s.color)===L;(!t||((c=this._board[k.a1])==null?void 0:c.type)!==fe||((l=this._board[k.a1])==null?void 0:l.color)!==N)&&(this._castling.w&=~v.QSIDE_CASTLE),(!t||((a=this._board[k.h1])==null?void 0:a.type)!==fe||((h=this._board[k.h1])==null?void 0:h.color)!==N)&&(this._castling.w&=~v.KSIDE_CASTLE),(!n||((d=this._board[k.a8])==null?void 0:d.type)!==fe||((u=this._board[k.a8])==null?void 0:u.color)!==L)&&(this._castling.b&=~v.QSIDE_CASTLE),(!n||((w=this._board[k.h8])==null?void 0:w.type)!==fe||((f=this._board[k.h8])==null?void 0:f.color)!==L)&&(this._castling.b&=~v.KSIDE_CASTLE)}_updateEnPassantSquare(){var r,s;if(this._epSquare===R)return;const t=this._epSquare+(this._turn===N?-16:16),n=this._epSquare+(this._turn===N?16:-16),i=[n+1,n-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((r=this._board[n])==null?void 0:r.color)!==de(this._turn)||((s=this._board[n])==null?void 0:s.type)!==A){this._epSquare=R;return}const o=c=>{var l,a;return!(c&136)&&((l=this._board[c])==null?void 0:l.color)===this._turn&&((a=this._board[c])==null?void 0:a.type)===A};i.some(o)||(this._epSquare=R)}_attacked(t,n){for(let i=k.a8;i<=k.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==t)continue;const o=this._board[i],r=i-n;if(r===0)continue;const s=r+119;if(Hi[s]&Wi[o.type]){if(o.type===A){if(r>0){if(o.color===N)return!0}else if(o.color===L)return!0;continue}if(o.type==="n"||o.type==="k")return!0;const c=Ui[s];let l=i+c,a=!1;for(;l!==n;){if(this._board[l]!=null){a=!0;break}l+=c}if(!a)return!0}}return!1}_isKingAttacked(t){const n=this._kings[t];return n===-1?!1:this._attacked(de(t),n)}isAttacked(t,n){return this._attacked(n,k[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,o=0;for(let r=k.a8;r<=k.h1;r++){if(o=(o+1)%2,r&136){r+=7;continue}const s=this._board[r];s&&(t[s.type]=s.type in t?t[s.type]+1:1,s.type===we&&n.push(o),i++)}if(i===2)return!0;if(i===3&&(t[we]===1||t[Ke]===1))return!0;if(i===t[we]+2){let r=0;const s=n.length;for(let c=0;c<s;c++)r+=n[c];if(r===0||r===s)return!0}return!1}isThreefoldRepetition(){const t=[],n={};let i=!1;for(;;){const o=this._undoMove();if(!o)break;t.push(o)}for(;;){const o=this.fen().split(" ").slice(0,4).join(" ");n[o]=o in n?n[o]+1:1,n[o]>=3&&(i=!0);const r=t.pop();if(r)this._makeMove(r);else break}return i}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:t=!1,square:n=void 0,piece:i=void 0}={}){const o=this._moves({square:n,piece:i});return t?o.map(r=>this._makePretty(r)):o.map(r=>this._moveToSan(r,o))}_moves({legal:t=!0,piece:n=void 0,square:i=void 0}={}){var w;const o=i?i.toLowerCase():void 0,r=n==null?void 0:n.toLowerCase(),s=[],c=this._turn,l=de(c);let a=k.a8,h=k.h1,d=!1;if(o)if(o in k)a=h=k[o],d=!0;else return[];for(let f=a;f<=h;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===l)continue;const{type:g}=this._board[f];let S;if(g===A){if(r&&r!==g)continue;S=f+Ne[c][0],this._board[S]||(Z(s,c,f,S,A),S=f+Ne[c][1],Yi[c]===re(f)&&!this._board[S]&&Z(s,c,f,S,A,void 0,v.BIG_PAWN));for(let m=2;m<4;m++)S=f+Ne[c][m],!(S&136)&&(((w=this._board[S])==null?void 0:w.color)===l?Z(s,c,f,S,A,this._board[S].type,v.CAPTURE):S===this._epSquare&&Z(s,c,f,S,A,A,v.EP_CAPTURE))}else{if(r&&r!==g)continue;for(let m=0,P=ht[g].length;m<P;m++){const p=ht[g][m];for(S=f;S+=p,!(S&136);){if(!this._board[S])Z(s,c,f,S,g);else{if(this._board[S].color===c)break;Z(s,c,f,S,g,this._board[S].type,v.CAPTURE);break}if(g===Ke||g===T)break}}}}if((r===void 0||r===T)&&(!d||h===this._kings[c])){if(this._castling[c]&v.KSIDE_CASTLE){const f=this._kings[c],g=f+2;!this._board[f+1]&&!this._board[g]&&!this._attacked(l,this._kings[c])&&!this._attacked(l,f+1)&&!this._attacked(l,g)&&Z(s,c,this._kings[c],g,T,void 0,v.KSIDE_CASTLE)}if(this._castling[c]&v.QSIDE_CASTLE){const f=this._kings[c],g=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(l,this._kings[c])&&!this._attacked(l,f-1)&&!this._attacked(l,g)&&Z(s,c,this._kings[c],g,T,void 0,v.QSIDE_CASTLE)}}if(!t||this._kings[c]===-1)return s;const u=[];for(let f=0,g=s.length;f<g;f++)this._makeMove(s[f]),this._isKingAttacked(c)||u.push(s[f]),this._undoMove();return u}move(t,{strict:n=!1}={}){let i=null;if(typeof t=="string")i=this._moveFromSan(t,n);else if(typeof t=="object"){const r=this._moves();for(let s=0,c=r.length;s<c;s++)if(t.from===K(r[s].from)&&t.to===K(r[s].to)&&(!("promotion"in r[s])||t.promotion===r[s].promotion)){i=r[s];break}}if(!i)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);const o=this._makePretty(i);return this._makeMove(i),o}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(t){const n=this._turn,i=de(n);if(this._push(t),this._board[t.to]=this._board[t.from],delete this._board[t.from],t.flags&v.EP_CAPTURE&&(this._turn===L?delete this._board[t.to-16]:delete this._board[t.to+16]),t.promotion&&(this._board[t.to]={type:t.promotion,color:n}),this._board[t.to].type===T){if(this._kings[n]=t.to,t.flags&v.KSIDE_CASTLE){const o=t.to-1,r=t.to+1;this._board[o]=this._board[r],delete this._board[r]}else if(t.flags&v.QSIDE_CASTLE){const o=t.to+1,r=t.to-2;this._board[o]=this._board[r],delete this._board[r]}this._castling[n]=0}if(this._castling[n]){for(let o=0,r=z[n].length;o<r;o++)if(t.from===z[n][o].square&&this._castling[n]&z[n][o].flag){this._castling[n]^=z[n][o].flag;break}}if(this._castling[i]){for(let o=0,r=z[i].length;o<r;o++)if(t.to===z[i][o].square&&this._castling[i]&z[i][o].flag){this._castling[i]^=z[i][o].flag;break}}t.flags&v.BIG_PAWN?n===L?this._epSquare=t.to-16:this._epSquare=t.to+16:this._epSquare=R,t.piece===A?this._halfMoves=0:t.flags&(v.CAPTURE|v.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===L&&this._moveNumber++,this._turn=i}undo(){const t=this._undoMove();return t?this._makePretty(t):null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;const n=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber;const i=this._turn,o=de(i);if(this._board[n.from]=this._board[n.to],this._board[n.from].type=n.piece,delete this._board[n.to],n.captured)if(n.flags&v.EP_CAPTURE){let r;i===L?r=n.to-16:r=n.to+16,this._board[r]={type:A,color:o}}else this._board[n.to]={type:n.captured,color:o};if(n.flags&(v.KSIDE_CASTLE|v.QSIDE_CASTLE)){let r,s;n.flags&v.KSIDE_CASTLE?(r=n.to+1,s=n.to-1):(r=n.to-2,s=n.to+1),this._board[r]=this._board[s],delete this._board[s]}return n}pgn({newline:t=`
`,maxWidth:n=0}={}){const i=[];let o=!1;for(const u in this._header)i.push("["+u+' "'+this._header[u]+'"]'+t),o=!0;o&&this._history.length&&i.push(t);const r=u=>{const w=this._comments[this.fen()];if(typeof w<"u"){const f=u.length>0?" ":"";u=`${u}${f}{${w}}`}return u},s=[];for(;this._history.length>0;)s.push(this._undoMove());const c=[];let l="";for(s.length===0&&c.push(r(""));s.length>0;){l=r(l);const u=s.pop();if(!u)break;if(!this._history.length&&u.color==="b"){const w=`${this._moveNumber}. ...`;l=l?`${l} ${w}`:w}else u.color==="w"&&(l.length&&c.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(u,this._moves({legal:!0})),this._makeMove(u)}if(l.length&&c.push(r(l)),typeof this._header.Result<"u"&&c.push(this._header.Result),n===0)return i.join("")+c.join(" ");const a=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},h=function(u,w){for(const f of w.split(" "))if(f){if(u+f.length>n){for(;a();)u--;i.push(t),u=0}i.push(f),u+=f.length,i.push(" "),u++}return a()&&u--,u};let d=0;for(let u=0;u<c.length;u++){if(d+c[u].length>n&&c[u].includes("{")){d=h(d,c[u]);continue}d+c[u].length>n&&u!==0?(i[i.length-1]===" "&&i.pop(),i.push(t),d=0):u!==0&&(i.push(" "),d++),i.push(c[u]),d+=c[u].length}return i.join("")}header(...t){for(let n=0;n<t.length;n+=2)typeof t[n]=="string"&&typeof t[n+1]=="string"&&(this._header[t[n]]=t[n+1]);return this._header}loadPgn(t,{strict:n=!1,newlineChar:i=`\r?
`}={}){function o(p){return p.replace(/\\/g,"\\")}function r(p){const y={},E=p.split(new RegExp(o(i)));let j="",H="";for(let C=0;C<E.length;C++){const _=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;j=E[C].replace(_,"$1"),H=E[C].replace(_,"$2"),j.trim().length>0&&(y[j]=H)}return y}t=t.trim();const c=new RegExp("^(\\[((?:"+o(i)+")|.)*\\])((?:\\s*"+o(i)+"){2}|(?:\\s*"+o(i)+")*$)").exec(t),l=c&&c.length>=2?c[1]:"";this.reset();const a=r(l);let h="";for(const p in a)p.toLowerCase()==="fen"&&(h=a[p]),this.header(p,a[p]);if(!n)h&&this.load(h,!0);else if(a.SetUp==="1"){if(!("FEN"in a))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(a.FEN,!0)}function d(p){return Array.from(p).map(function(y){return y.charCodeAt(0)<128?y.charCodeAt(0).toString(16):encodeURIComponent(y).replace(/%/g,"").toLowerCase()}).join("")}function u(p){return p.length==0?"":decodeURIComponent("%"+(p.match(/.{1,2}/g)||[]).join("%"))}const w=function(p){return p=p.replace(new RegExp(o(i),"g")," "),`{${d(p.slice(1,p.length-1))}}`},f=function(p){if(p.startsWith("{")&&p.endsWith("}"))return u(p.slice(1,p.length-1))};let g=t.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${o(i)}]*)`,"g"),function(p,y,E){return y!==void 0?w(y):" "+w(`{${E.slice(1)}}`)}).replace(new RegExp(o(i),"g")," ");const S=/(\([^()]+\))+?/g;for(;S.test(g);)g=g.replace(S,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");let m=g.trim().split(new RegExp(/\s+/));m=m.filter(p=>p!=="");let P="";for(let p=0;p<m.length;p++){const y=f(m[p]);if(y!==void 0){this._comments[this.fen()]=y;continue}const E=this._moveFromSan(m[p],n);if(E==null)if(Xi.indexOf(m[p])>-1)P=m[p];else throw new Error(`Invalid move in PGN: ${m[p]}`);else P="",this._makeMove(E)}P&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",P)}_moveToSan(t,n){let i="";if(t.flags&v.KSIDE_CASTLE)i="O-O";else if(t.flags&v.QSIDE_CASTLE)i="O-O-O";else{if(t.piece!==A){const o=eo(t,n);i+=t.piece.toUpperCase()+o}t.flags&(v.CAPTURE|v.EP_CAPTURE)&&(t.piece===A&&(i+=K(t.from)[0]),i+="x"),i+=K(t.to),t.promotion&&(i+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(t,n=!1){const i=Oe(t);let o=pt(i),r=this._moves({legal:!0,piece:o});for(let u=0,w=r.length;u<w;u++)if(i===Oe(this._moveToSan(r[u],r)))return r[u];if(n)return null;let s,c,l,a,h,d=!1;if(c=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),c?(s=c[1],l=c[2],a=c[3],h=c[4],l.length==1&&(d=!0)):(c=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),c&&(s=c[1],l=c[2],a=c[3],h=c[4],l.length==1&&(d=!0))),o=pt(i),r=this._moves({legal:!0,piece:s||o}),!a)return null;for(let u=0,w=r.length;u<w;u++)if(l){if((!s||s.toLowerCase()==r[u].piece)&&k[l]==r[u].from&&k[a]==r[u].to&&(!h||h.toLowerCase()==r[u].promotion))return r[u];if(d){const f=K(r[u].from);if((!s||s.toLowerCase()==r[u].piece)&&k[a]==r[u].to&&(l==f[0]||l==f[1])&&(!h||h.toLowerCase()==r[u].promotion))return r[u]}}else if(i===Oe(this._moveToSan(r[u],r)).replace("x",""))return r[u];return null}ascii(){let t=`   +------------------------+
`;for(let n=k.a8;n<=k.h1;n++){if(be(n)===0&&(t+=" "+"87654321"[re(n)]+" |"),this._board[n]){const i=this._board[n].type,r=this._board[n].color===N?i.toUpperCase():i.toLowerCase();t+=" "+r+" "}else t+=" . ";n+1&136&&(t+=`|
`,n+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const n=this._moves({legal:!1});let i=0;const o=this._turn;for(let r=0,s=n.length;r<s;r++)this._makeMove(n[r]),this._isKingAttacked(o)||(t-1>0?i+=this.perft(t-1):i++),this._undoMove();return i}_makePretty(t){const{color:n,piece:i,from:o,to:r,flags:s,captured:c,promotion:l}=t;let a="";for(const w in v)v[w]&s&&(a+=Qi[w]);const h=K(o),d=K(r),u={color:n,piece:i,from:h,to:d,san:this._moveToSan(t,this._moves({legal:!0})),flags:a,lan:h+d,before:this.fen(),after:""};return this._makeMove(t),u.after=this.fen(),this._undoMove(),c&&(u.captured=c),l&&(u.promotion=l,u.lan+=l),u}turn(){return this._turn}board(){const t=[];let n=[];for(let i=k.a8;i<=k.h1;i++)this._board[i]==null?n.push(null):n.push({square:K(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(t.push(n),n=[],i+=8);return t}squareColor(t){if(t in k){const n=k[t];return(re(n)+be(n))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const o=n.pop();if(!o)break;t?i.push(this._makePretty(o)):i.push(this._moveToSan(o,this._moves())),this._makeMove(o)}return i}_pruneComments(){const t=[],n={},i=o=>{o in this._comments&&(n[o]=this._comments[o])};for(;this._history.length>0;)t.push(this._undoMove());for(i(this.fen());;){const o=t.pop();if(!o)break;this._makeMove(o),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const n=this._comments[t];return delete this._comments[t],{fen:t,comment:n}})}setCastlingRights(t,n){for(const o of[T,X])n[o]!==void 0&&(n[o]?this._castling[t]|=ve[o]:this._castling[t]&=~ve[o]);this._updateCastlingRights();const i=this.getCastlingRights(t);return(n[T]===void 0||n[T]===i[T])&&(n[X]===void 0||n[X]===i[X])}getCastlingRights(t){return{[T]:(this._castling[t]&ve[T])!==0,[X]:(this._castling[t]&ve[X])!==0}}moveNumber(){return this._moveNumber}};class no{constructor(t,n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",i=c=>{},o=async c=>"q",r=c=>{},s=c=>{}){D(this,"chessJS");D(this,"gameIsOver",!1);this.cg=t,this.stateChangeCallback=i,this.promotionCallback=o,this.moveCallback=r,this.gameOverCallback=s,this.cg.set({movable:{free:!1}}),this.chessJS=new to(n),this.load(n)}load(t){this.chessJS.load(t),this._checkForGameOver(),this.cg.set({animation:{enabled:!1}});const n=this.chessJS.turn()=="w"?"white":"black";this.cg.set({fen:t,turnColor:n,check:this.chessJS.inCheck(),lastMove:void 0,selected:void 0,movable:{free:!1,color:n,dests:this.possibleMovesDests(),events:{after:(i,o)=>{this._chessgroundMoveCallback(i,o)}}}}),this.cg.set({animation:{enabled:!0}}),this.stateChangeCallback(this)}async _chessgroundMoveCallback(t,n){if(t==="a0"||n==="a0")throw Error("invalid square");let i;if(this._moveIsPromotion(t,n)){const o=await this.promotionCallback(n);i=this.chessJS.move({from:t,to:n,promotion:o})}else i=this.chessJS.move({from:t,to:n});this._updateChessgroundAfterMove(i)}_moveIsPromotion(t,n){return this.chessJS.get(t).type==="p"&&(n.charAt(1)=="1"||n.charAt(1)=="8")}move(t){if(this.gameIsOver)throw new Error("Invalid move: Game is over.");const n=this.chessJS.move(t);this.cg.move(n.from,n.to),this._updateChessgroundAfterMove(n)}_updateChessgroundAfterMove(t){(t.flags.includes("e")||t.flags.includes("p"))&&this.cg.set({fen:this.chessJS.fen()}),this.chessJS.inCheck()&&this.cg.set({check:!0}),this.moveCallback(t),this._checkForGameOver(),this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this)}_updateChessgroundWithPossibleMoves(){const t=this.chessJS.turn()=="w"?"white":"black";this.cg.set({turnColor:t,movable:{color:t,dests:this.possibleMovesDests()}})}_checkForGameOver(){if(this.chessJS.isCheckmate()){const t=this.chessJS.turn()=="w"?0:1;this.gameOverCallback({reason:"checkmate",result:t}),this.gameIsOver=!0}else this.chessJS.isStalemate()?(this.gameOverCallback({reason:"stalemate",result:.5}),this.gameIsOver=!0):this.chessJS.isInsufficientMaterial()?(this.gameOverCallback({reason:"insufficient material",result:.5}),this.gameIsOver=!0):this.chessJS.isThreefoldRepetition()?(this.gameOverCallback({reason:"repetition",result:.5}),this.gameIsOver=!0):this.chessJS.isDraw()?(this.gameOverCallback({reason:"fifty-move rule",result:.5}),this.gameIsOver=!0):this.gameIsOver=!1}possibleMovesDests(){const t=new Map;return this.gameIsOver||ji.forEach(n=>{const i=this.chessJS.moves({square:n,verbose:!0});i.length&&t.set(n,i.map(o=>o.to))}),t}reset(){this.load("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1")}undo(){const t=this.chessJS.undo();return this.cg.set({fen:this.chessJS.fen(),turnColor:this.chessJS.turn()=="w"?"white":"black",lastMove:void 0}),this.gameIsOver=!1,this._updateChessgroundWithPossibleMoves(),this.stateChangeCallback(this),t}toggleOrientation(){this.cg.toggleOrientation()}isGameOver(){return this.gameIsOver}fen(){return this.chessJS.fen()}turn(){return this.chessJS.turn()}moveNumber(){return this.chessJS.moveNumber()}history({verbose:t=!1}={}){return this.chessJS.history({verbose:t})}board(){return this.chessJS.board()}}function io(e){let t,n,i,o={};return n=new Ri({props:o}),e[14](n),{c(){t=he("div"),hn(n.$$.fragment),this.h()},l(r){t=ge(r,"DIV",{style:!0});var s=pe(t);gn(n.$$.fragment,s),s.forEach(J),this.h()},h(){Ie(t,"position","relative")},m(r,s){Ce(r,t,s),pn(n,t,null),e[15](t),i=!0},p(r,[s]){const c={};n.$set(c)},i(r){i||(mn(n.$$.fragment,r),i=!0)},o(r){bn(n.$$.fragment,r),i=!1},d(r){r&&J(t),e[14](null),_n(n),e[15](null)}}}function oo(e,t,n){const i=vn();let o,r,{moveNumber:s=0}=t,{turn:c="w"}=t,{history:l=[]}=t,{isGameOver:a=!1}=t,{fen:h="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"}=t,d;function u(_){if(!d)throw new Error("component not mounted yet");d.load(_)}function w(_){if(!d)throw new Error("component not mounted yet");d.move(_)}function f({verbose:_=!1}={}){if(!d)throw new Error("component not mounted yet");return d.history({verbose:_})}function g(){if(!d)throw new Error("component not mounted yet");return d.board()}function S(){if(!d)throw new Error("component not mounted yet");return d.undo()}function m(){if(!d)throw new Error("component not mounted yet");d.reset()}function P(){if(!d)throw new Error("component not mounted yet");d.toggleOrientation()}function p(_){n(6,h=_.fen()),n(2,s=_.moveNumber()),n(3,c=_.turn()),n(4,l=_.history()),n(5,a=_.isGameOver())}function y(_){return new Promise((O,q)=>{const G=new Bi({target:r,props:{square:_,callback:Pe=>{G.$destroy(),O(Pe)}}})})}function E(_){i("move",_)}function j(_){i("gameOver",_)}mt(()=>{d=new no(o,h,p,y,E,j)});function H(_){xe[_?"unshift":"push"](()=>{o=_,n(0,o)})}function C(_){xe[_?"unshift":"push"](()=>{r=_,n(1,r)})}return e.$$set=_=>{"moveNumber"in _&&n(2,s=_.moveNumber),"turn"in _&&n(3,c=_.turn),"history"in _&&n(4,l=_.history),"isGameOver"in _&&n(5,a=_.isGameOver),"fen"in _&&n(6,h=_.fen)},[o,r,s,c,l,a,h,u,w,f,g,S,m,P,H,C]}class ao extends Le{constructor(t){super(),Fe(this,t,oo,io,Be,{moveNumber:2,turn:3,history:4,isGameOver:5,fen:6,load:7,move:8,getHistory:9,getBoard:10,undo:11,reset:12,toggleOrientation:13})}get load(){return this.$$.ctx[7]}get move(){return this.$$.ctx[8]}get getHistory(){return this.$$.ctx[9]}get getBoard(){return this.$$.ctx[10]}get undo(){return this.$$.ctx[11]}get reset(){return this.$$.ctx[12]}get toggleOrientation(){return this.$$.ctx[13]}}export{ao as C};
